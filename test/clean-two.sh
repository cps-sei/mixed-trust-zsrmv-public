#!/bin/sh
sort -t" " -nk2 $1 | gawk 'BEGIN {rid0active="0" ; rid1active="0"} { rid=$1 ; if (rid =="0" ) {orid="1" } else {orid="0"} ; ts=$2 ; et=$3 ; if (et == "4") { if (rid == "0") { rid0active="1"} else { if (rid == "1") {rid1active="1"} } } ; if (et == "3" ) { if (rid == "0") {rid0active="0"} else {if (rid=="1") {rid1active="0"} } } ; if (et == "58") {et="4" } else {if (et == "59") {et = "3"}} if (et != "50" && et != "51" && et != "52" && et != "53" && et != "54" && et != "55" ) { if ($3 == "58" && (rid0active == "1" || rid1active=="1")) { print orid " " ts " 3" } else { if ( $3 == "59" && (rid0active=="1" || rid1active=="1")) { print orid " " ts " 4"} else {} } ;  print rid " " ts " " et}}' -
